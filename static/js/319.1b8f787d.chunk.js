"use strict";(self.webpackChunkcine_aurora=self.webpackChunkcine_aurora||[]).push([[319],{319:(e,n,o)=>{o.r(n),o.d(n,{default:()=>p});var i=o(555),r=o(43),t=o(163),s=o(667),a=o(441),l=o(729),d=o(840),c=o(579);function p(){const{seriesId:e,seasonNumber:n,episodeNumber:o}=(0,t.g)(),p=(0,t.Zp)(),{currentUser:m}=(0,l.A)(),b=(0,r.useRef)(null),[x,h]=(0,r.useState)(null),[f,g]=(0,r.useState)(null),[v,y]=(0,r.useState)(!0),[N,j]=(0,r.useState)(null),[k,w]=(0,r.useState)(null);return(0,r.useEffect)(()=>{e&&n&&o&&async function(){try{y(!0);const r=(0,s.H9)(a.db,"series",e),t=await(0,s.getDoc)(r);if(!t.exists())throw new Error("S\xe9rie n\xe3o encontrada");h((0,i.A)({id:t.id},t.data()));const l=(0,s.rJ)(a.db,"series/".concat(e,"/seasons")),d=(0,s.P)(l,(0,s._M)("number","==",parseInt(n))),c=await(0,s.GG)(d);if(c.empty)throw new Error("Temporada n\xe3o encontrada");const p=c.docs[0].id,u=(0,s.rJ)(a.db,"series/".concat(e,"/seasons/").concat(p,"/episodes")),m=(0,s.P)(u,(0,s._M)("number","==",parseInt(o))),b=await(0,s.GG)(m);if(b.empty)throw new Error("Epis\xf3dio n\xe3o encontrado");const x=(0,i.A)((0,i.A)({id:b.docs[0].id},b.docs[0].data()),{},{seasonNumber:parseInt(n),episodeNumber:parseInt(o)});g(x);const f=(0,s.rJ)(a.db,"series/".concat(e,"/seasons/").concat(p,"/episodes")),v=(0,s.P)(f,(0,s.My)("number","asc")),N=await(0,s.GG)(v),j=[];N.forEach(e=>{j.push((0,i.A)((0,i.A)({id:e.id},e.data()),{},{episodeNumber:e.data().number||0}))});const k=j.findIndex(e=>e.episodeNumber===parseInt(o));if(k<j.length-1)w((0,i.A)((0,i.A)({},j[k+1]),{},{seasonNumber:parseInt(n)}));else{const o=(0,s.rJ)(a.db,"series/".concat(e,"/seasons")),r=(0,s.P)(o,(0,s._M)("number","==",parseInt(n)+1)),t=await(0,s.GG)(r);if(!t.empty){const o=t.docs[0].id,r=(0,s.rJ)(a.db,"series/".concat(e,"/seasons/").concat(o,"/episodes")),l=(0,s.P)(r,(0,s.My)("number","asc"),(0,s.AB)(1)),d=await(0,s.GG)(l);if(!d.empty){const e=d.docs[0];w((0,i.A)((0,i.A)({},e.data()),{},{id:e.id,seasonNumber:parseInt(n)+1,episodeNumber:e.data().number||1}))}}}y(!1)}catch(r){console.error("Erro ao carregar epis\xf3dio:",r),j(r.message),y(!1)}}()},[e,n,o]),(0,r.useEffect)(()=>{if(!m||!f)return;const e=b.current;if(!e)return;let n=0,o=null;async function r(){if(!m||!f||!e.duration)return;const o=Date.now();if(o-n<5e3)return;n=o;const i={seriesId:x.id,seasonNumber:f.seasonNumber,episodeNumber:f.episodeNumber,currentTime:e.currentTime,duration:e.duration,updatedAt:new Date,title:f.title||"Epis\xf3dio ".concat(f.episodeNumber),thumbnailUrl:f.thumbnailUrl||x.thumbnailUrl};try{const e=(0,s.H9)(a.db,"users",m.uid),n="".concat(x.id,"-").concat(f.seasonNumber,"-").concat(f.episodeNumber),o=(0,s.H9)(a.db,"users",m.uid,"watching",n);(await(0,s.getDoc)(o)).exists()?await(0,s.mZ)(o,i):(await(0,s.BN)(o,i),await(0,s.mZ)(e,{watching:(0,s.hq)({seriesId:x.id,seasonNumber:f.seasonNumber,episodeNumber:f.episodeNumber,title:f.title||"Epis\xf3dio ".concat(f.episodeNumber),thumbnailUrl:f.thumbnailUrl||x.thumbnailUrl||""})},{merge:!0}))}catch(r){console.error("Erro ao salvar progresso:",r)}}function t(){o&&clearTimeout(o),o=setTimeout(r,1e3)}async function l(){if(m&&f&&x)try{const e=(0,s.H9)(a.db,"users",m.uid,"watching","".concat(x.id,"-").concat(f.seasonNumber,"-").concat(f.episodeNumber)),n=await(0,s.getDoc)(e),o=(0,i.A)({seriesId:x.id,seasonNumber:f.seasonNumber,episodeNumber:f.episodeNumber,completed:!0,completedAt:new Date,title:f.title||"Epis\xf3dio ".concat(f.episodeNumber),thumbnailUrl:f.thumbnailUrl||x.thumbnailUrl||""},n.exists()?{currentTime:n.data().currentTime,duration:n.data().duration,updatedAt:new Date}:{});if(n.exists())await(0,s.mZ)(e,o);else{await(0,s.BN)(e,o);const n=(0,s.H9)(a.db,"users",m.uid);await(0,s.mZ)(n,{watching:(0,s.hq)({seriesId:x.id,seasonNumber:f.seasonNumber,episodeNumber:f.episodeNumber,title:f.title||"Epis\xf3dio ".concat(f.episodeNumber),thumbnailUrl:f.thumbnailUrl||x.thumbnailUrl||""})},{merge:!0})}}catch(e){console.error("Erro ao marcar epis\xf3dio como conclu\xeddo:",e)}}return e.addEventListener("timeupdate",t),e.addEventListener("ended",l),async function(){if(m&&e&&x&&f)try{const n="".concat(x.id,"-").concat(f.seasonNumber,"-").concat(f.episodeNumber),o=(0,s.H9)(a.db,"users",m.uid,"watching",n),i=await(0,s.getDoc)(o);if(i.exists()){const n=i.data();if((!n.completed||n.completedAt&&new Date-n.completedAt<864e5)&&n.currentTime&&n.duration)if(n.currentTime/n.duration>.9)e.currentTime=0;else{const o=Math.max(0,n.currentTime-5);e.currentTime=o}else n.completed&&(e.currentTime=0)}}catch(n){console.error("Erro ao carregar progresso:",n)}}(),()=>{e.removeEventListener("timeupdate",t),e.removeEventListener("ended",l),o&&clearTimeout(o)}},[m,f,x,e,n,o]),v?(0,c.jsx)("div",{style:u.loadingContainer,children:(0,c.jsx)("div",{children:"Carregando epis\xf3dio..."})}):N?(0,c.jsx)("div",{style:u.errorContainer,children:(0,c.jsxs)("div",{style:u.errorMessage,children:[(0,c.jsx)("h2",{children:"Erro ao carregar o epis\xf3dio"}),(0,c.jsx)("p",{children:N}),(0,c.jsx)("button",{onClick:()=>p(-1),style:u.backButton,children:"Voltar"})]})}):f?(0,c.jsxs)("div",{style:u.container,children:[(0,c.jsx)(d.A,{}),(0,c.jsxs)("main",{style:u.main,children:[(0,c.jsxs)("div",{style:u.videoContainer,children:[(0,c.jsxs)("div",{style:u.videoWrapper,children:[(0,c.jsx)("video",{ref:b,src:f.videoUrl,controls:!0,autoPlay:!0,style:u.video,playsInline:!0}),!f.videoUrl&&(0,c.jsx)("div",{style:u.videoError,children:(0,c.jsxs)("div",{style:u.videoErrorContent,children:[(0,c.jsx)("div",{style:u.videoErrorIcon,children:"\ud83d\udeab"}),(0,c.jsx)("h3",{children:"V\xeddeo n\xe3o dispon\xedvel"}),(0,c.jsx)("p",{children:"O v\xeddeo solicitado n\xe3o p\xf4de ser carregado."}),(0,c.jsx)("button",{onClick:()=>p(-1),style:u.videoErrorButton,children:"Voltar"})]})})]}),(0,c.jsxs)("div",{style:u.episodeInfo,children:[(0,c.jsxs)("h1",{style:u.episodeTitle,children:[(null===x||void 0===x?void 0:x.title)||"S\xe9rie"," - ",f.title||"Epis\xf3dio ".concat(f.episodeNumber),f.seasonNumber&&(0,c.jsxs)("span",{style:u.seasonEpisode,children:["Temporada ",f.seasonNumber," \u2022 Epis\xf3dio ",f.episodeNumber]})]}),f.description&&(0,c.jsx)("p",{style:u.episodeDescription,children:f.description}),k&&(0,c.jsxs)("div",{style:u.nextEpisode,children:[(0,c.jsx)("h3",{children:"Pr\xf3ximo:"}),(0,c.jsxs)("button",{onClick:()=>{p("/watch/series/".concat(e,"/season/").concat(k.seasonNumber,"/episode/").concat(k.episodeNumber))},style:u.nextEpisodeButton,children:[(0,c.jsx)("span",{style:u.nextEpisodePlayIcon,children:"\u25b6"}),(0,c.jsxs)("div",{style:u.nextEpisodeInfo,children:[(0,c.jsx)("span",{style:u.nextEpisodeTitle,children:k.title||"Epis\xf3dio ".concat(k.episodeNumber)}),(0,c.jsxs)("span",{style:u.nextEpisodeDetails,children:[k.seasonNumber!==f.seasonNumber?"Temporada ".concat((k.seasonNumber,f.seasonNumber)," \u2022 "):"","Epis\xf3dio ",k.episodeNumber]})]})]})]})]})]}),(0,c.jsx)("div",{style:u.actions,children:(0,c.jsx)("button",{onClick:()=>p(-1),style:u.backButton,children:"Voltar para a s\xe9rie"})})]})]}):(0,c.jsx)("div",{style:u.errorContainer,children:(0,c.jsxs)("div",{style:u.errorMessage,children:[(0,c.jsx)("h2",{children:"Epis\xf3dio n\xe3o encontrado"}),(0,c.jsx)("button",{onClick:()=>p(-1),style:u.backButton,children:"Voltar"})]})})}const u={container:{backgroundColor:"#0f0f0f",minHeight:"100vh",color:"#fff",display:"flex",flexDirection:"column"},main:{flex:1,padding:"20px 5%",maxWidth:"1400px",margin:"0 auto",paddingTop:"80px",width:"100%"},videoContainer:{width:"100%",marginBottom:"30px"},videoWrapper:{width:"100%",backgroundColor:"#000",borderRadius:"8px",overflow:"hidden",position:"relative",paddingTop:"56.25%"},video:{position:"absolute",top:0,left:0,width:"100%",height:"100%",outline:"none",backgroundColor:"#000"},videoError:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#111",color:"#fff",textAlign:"center",padding:"20px",zIndex:10},videoErrorContent:{maxWidth:"400px",margin:"0 auto"},videoErrorIcon:{fontSize:"3rem",marginBottom:"15px"},videoErrorButton:{marginTop:"20px",padding:"10px 20px",backgroundColor:"#e50914",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"1rem"},episodeInfo:{marginTop:"20px",padding:"0 10px"},episodeTitle:{fontSize:"1.8rem",margin:"0 0 10px 0",color:"#fff"},seasonEpisode:{display:"block",fontSize:"1rem",color:"#aaa",marginTop:"5px",fontWeight:"normal"},episodeDescription:{color:"#ddd",lineHeight:1.6,margin:"15px 0 0 0",fontSize:"1.05rem"},nextEpisode:{marginTop:"30px",paddingTop:"20px",borderTop:"1px solid #333"},nextEpisodeButton:{display:"flex",alignItems:"center",gap:"15px",width:"100%",backgroundColor:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"4px",padding:"15px",textAlign:"left",cursor:"pointer",transition:"all 0.2s ease",marginTop:"10px",":hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},nextEpisodePlayIcon:{fontSize:"1.5rem",color:"#fff",backgroundColor:"rgba(255, 255, 255, 0.2)",width:"40px",height:"40px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},nextEpisodeInfo:{display:"flex",flexDirection:"column",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},nextEpisodeTitle:{fontSize:"1rem",color:"#fff",overflow:"hidden",textOverflow:"ellipsis"},nextEpisodeDetails:{fontSize:"0.9rem",color:"#aaa",marginTop:"3px"},actions:{display:"flex",justifyContent:"center",marginTop:"20px"},backButton:{backgroundColor:"rgba(255, 255, 255, 0.1)",border:"none",color:"#fff",padding:"10px 20px",borderRadius:"4px",cursor:"pointer",fontSize:"1rem",display:"flex",alignItems:"center",gap:"8px",transition:"all 0.2s ease",":hover":{backgroundColor:"rgba(255, 255, 255, 0.2)"}},loadingContainer:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#0f0f0f",color:"#fff",fontSize:"1.2rem"},errorContainer:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#0f0f0f",color:"#e50914",textAlign:"center",padding:"20px"},errorMessage:{maxWidth:"500px",backgroundColor:"rgba(20, 20, 20, 0.9)",padding:"30px",borderRadius:"8px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)"}}},840:(e,n,o)=>{o.d(n,{A:()=>a});var i=o(43),r=o(163),t=o(729),s=o(579);function a(){const[e,n]=(0,i.useState)(!1),[o,a]=(0,i.useState)(!1),l=(0,r.Zp)(),d=(0,r.zy)(),{currentUser:c,logout:p}=(0,t.A)();async function u(){try{await p(),l("/login",{replace:!0})}catch(e){console.error(e)}}(0,i.useEffect)(()=>{function e(){n(window.scrollY>10)}return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),(0,i.useEffect)(()=>{a(!1)},[d]);const m=e=>{l(e),a(!1)};return(0,s.jsxs)("header",{className:"navbar".concat(e?" navbar--scrolled":""),children:[(0,s.jsxs)("div",{className:"navbar__brand",onClick:()=>m("/app"),style:{cursor:"pointer",display:"flex",alignItems:"center",gap:"10px"},children:[(0,s.jsx)("img",{src:"/logo192.png",alt:"Logo CineAurora",style:{height:"40px",width:"auto"}}),(0,s.jsx)("span",{style:{fontWeight:"bold",fontSize:"1.2rem"},children:"CineAurora"})]}),(0,s.jsxs)("nav",{className:"navbar__nav",children:[(0,s.jsx)("button",{className:"navbar__link".concat("/app"!==d.pathname||d.search?"":" navbar__link--active"),onClick:()=>l("/app"),children:"Home"}),(0,s.jsx)("button",{className:"navbar__link".concat("?type=movie"===d.search?" navbar__link--active":""),onClick:()=>l("/app?type=movie"),children:"Filmes"}),(0,s.jsx)("button",{className:"navbar__link".concat("?type=series"===d.search?" navbar__link--active":""),onClick:()=>l("/app?type=series"),children:"S\xe9ries"}),(0,s.jsx)("button",{className:"navbar__link".concat("/my-list"===d.pathname?" navbar__link--active":""),onClick:()=>l("/my-list"),children:"Minha lista"})]}),(0,s.jsxs)("div",{className:"navbar__right",children:["matheus0mendes0marinho@gmail.com"===(null===c||void 0===c?void 0:c.email)&&(0,s.jsx)("button",{className:"btn",type:"button",onClick:()=>l("/admin"),children:"Admin"}),(0,s.jsx)("button",{className:"navbar__icon","aria-label":"Buscar",onClick:()=>l("/search"),children:"\ud83d\udd0d"}),(0,s.jsx)("button",{className:"btn",onClick:u,children:"Sair"})]}),(0,s.jsxs)("button",{className:"navbar__mobile-toggle ".concat(o?"open":""),onClick:()=>a(!o),"aria-label":"Menu",children:[(0,s.jsx)("span",{}),(0,s.jsx)("span",{}),(0,s.jsx)("span",{})]}),(0,s.jsxs)("div",{className:"navbar__mobile-menu ".concat(o?"open":""),children:[(0,s.jsx)("button",{className:"navbar__mobile-link",onClick:()=>m("/app"),children:"Home"}),(0,s.jsx)("button",{className:"navbar__mobile-link",onClick:()=>m("/app?type=movie"),children:"Filmes"}),(0,s.jsx)("button",{className:"navbar__mobile-link",onClick:()=>m("/app?type=series"),children:"S\xe9ries"}),(0,s.jsx)("button",{className:"navbar__mobile-link",onClick:()=>m("/my-list"),children:"Minha lista"}),"matheus0mendes0marinho@gmail.com"===(null===c||void 0===c?void 0:c.email)&&(0,s.jsx)("button",{className:"navbar__mobile-link",onClick:()=>m("/admin"),children:"Admin"}),(0,s.jsx)("button",{className:"navbar__mobile-link",onClick:()=>{u(),a(!1)},style:{color:"#ef4444"},children:"Sair"})]})]})}}}]);
//# sourceMappingURL=319.1b8f787d.chunk.js.map